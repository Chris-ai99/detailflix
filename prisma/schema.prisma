generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
}

enum ServicePricingType {
  AW
  HOURLY
}

enum DocumentType {
  OFFER
  INVOICE
  PURCHASE_CONTRACT
}

enum DocumentStatus {
  DRAFT
  SENT
  PAID
  CANCELLED
  CONVERTED
}

enum TaxMode {
  REGULAR_VAT
  MARGIN_SCHEME
  EU_NET_WITH_DEPOSIT
  NON_EU_NET_WITH_DEPOSIT
}

model Customer {
  id     String  @id @default(cuid())
  name   String
  email  String?
  phone  String?
  vatId  String?
  street String?
  zip    String?
  city   String?
  notes  String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  documents Document[]
}

model ServiceItem {
  id String @id @default(cuid())

  // Anzeige
  name     String
  category String? // z.B. "Aufbereitung Außen"
  unit     String  @default("Stk") // bleibt für später (falls du willst)

  // Preis-Modell
  pricingType ServicePricingType @default(AW)

  // AW-Modus:
  awDurationMinutes Int? // z.B. 60
  awUnitPriceCents  Int? // z.B. 5882 (=58,82€) pro 1 AW (für die gewählte Dauer)
  awDefaultQty      Float? @default(1.0) // z.B. 1.0

  // Stundenlohn-Modus:
  hourlyRateCents Int? // z.B. 4202 (=42,02€/h)
  defaultMinutes  Int? // z.B. 300 (=5h)

  // Material / Zuschläge (optional, MVP)
  materialPercent    Int? @default(0) // z.B. 0..100
  materialFixedCents Int? @default(0)

  // Steuer / Status
  vatRate Int     @default(19)
  active  Boolean @default(true)

  // Texte
  descriptionHtml String?
  shortText       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vehicle {
  id            String  @id @default(cuid())
  vin           String?
  make          String?
  model         String?
  year          Int?
  mileage       Int?
  purchaseCents Int? // EK
  notes         String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  documents Document[]
}

model Document {
  id        String         @id @default(cuid())
  docType   DocumentType
  docNumber String
  status    DocumentStatus @default(DRAFT)

  issueDate  DateTime  @default(now())
  dueDate    DateTime?
  validUntil DateTime?

  taxMode       TaxMode @default(REGULAR_VAT)
  depositCents  Int? // Kaution, optional
  notesPublic   String?
  notesInternal String?

  customerId String?
  customer   Customer? @relation(fields: [customerId], references: [id])

  vehicleId String?
  vehicle   Vehicle? @relation(fields: [vehicleId], references: [id])

  lines DocumentLine[]

  // Totals gespeichert (damit PDF schnell ist)
  netTotalCents   Int @default(0)
  vatTotalCents   Int @default(0)
  grossTotalCents Int @default(0)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DocumentLine {
  id         String   @id @default(cuid())
  documentId String
  document   Document @relation(fields: [documentId], references: [id])

  title        String
  qty          Int    @default(1)
  unit         String @default("Stk")
  unitNetCents Int
  vatRate      Int    @default(19)

  lineNetCents   Int @default(0)
  lineVatCents   Int @default(0)
  lineGrossCents Int @default(0)
}
